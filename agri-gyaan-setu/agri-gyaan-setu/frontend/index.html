<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>AgriSmart Login</title>
    <link rel="stylesheet" href="{% static 'assets/css/styles.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    body {
      background-image: url(images/backgroundimage.jpg);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center center;
      height: 100vh;
      margin: 0;
    }
        .quick-tiles {
            display: flex;
            gap: 16px;
            margin-top: 20px;
            justify-content: center;
        }
        .tile {
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            padding: 18px 22px;
            width: 220px;
            text-align: center;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            transition: transform .12s ease, box-shadow .12s ease;
            text-decoration: none;
            color: #1b4d1b;
            font-weight: 600;
        }
        .tile:hover { transform: translateY(-4px); box-shadow: 0 10px 26px rgba(0,0,0,0.16); }
  </style>
</head>
<body>
    <div class="center-container">
        <div class="logo-section">
            <div class="logo-icon">
                <svg width="56" height="56" viewBox="0 0 56 56" fill="none">
                    <rect width="56" height="56" rx="12" fill="#347a2a"/>
                    <path d="M28 16v9m0 0c-6 0-9 4.667-9 9s3 6 6 6c2.667 0 4.667-2 6-4m-3-11c6 0 9 4.667 9 9s-3 6-6 6c-2.667 0-4.667-2-6-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h1 class="main-title">AgriSmart</h1>
            <p class="subtitle">Welcome to AgriSmart</p>
        </div>
        <div style="position: absolute; right: 18px; top: 18px;">
            <button id="language-btn" class="language-selector" style="background:#fff;border:1px solid #e6e6e6;padding:8px 12px;border-radius:6px;">üåê English ‚ñº</button>
        </div>
        <form class="login-form">
            <h2>Login</h2>
            <p>
                Don't have an account?
                <a href="signup/" class="signup-link">Sign Up</a>
            </p>
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Email" required>
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit" class="login-button">Login</button>
        </form>

        <div class="quick-tiles" aria-label="Quick actions">
            <a class="tile" href="/crop-recommend/">Crop Recommendation</a>
            <a class="tile" href="/price-forecast/">Price Forecast</a>
        </div>
    </div>

    <!-- Place the script at the end for reliable loading -->
    <script src="{% static 'assets/js/api.js' %}"></script>
    <script src="{% static 'assets/js/i18n.js' %}"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.querySelector('.login-form');
        if(form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                try {
                    const response = await fetch('/api/auth/login/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: email,
                            password: password
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        // Store farmer info in localStorage
                        localStorage.setItem('farmer_id', data.farmer_id);
                        localStorage.setItem('farmer_name', data.name);
                        localStorage.setItem('farmer_email', data.email);
                        
                        // Redirect to dashboard
                        window.location.href = "/dashboard/";
                    } else {
                        const error = await response.json();
                        alert('Login failed: ' + (error.error || 'Invalid credentials'));
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed. Please try again.');
                }
            });
        }
    });
    </script>
</body>
</html>
