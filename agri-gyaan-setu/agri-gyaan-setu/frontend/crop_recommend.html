<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crop Recommendation | AgriSmart</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    body { background: #f6faf6;}
    .crop-header {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 1.1rem 2rem 0.7rem 2rem;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 2px 12px rgba(80,110,50,0.08);
        margin-bottom: 18px;
    }
    .back-btn { background: none; border: none; font-size: 1.4rem; color: #24411f; cursor: pointer;}
    .crop-header-title { font-size: 1.15rem; font-weight: bold; color: #24411f; }
    .crop-section-title { font-size: 2.5rem; text-align: center; font-weight: 700; margin-top: 36px; color: #193718;}
    .crop-section-subtitle { color: #5a715a; text-align: center; font-size: 1.2rem; margin-bottom: 32px;}
    .form-card {
        background: #fff; border-radius: 16px;
        padding: 35px 30px 24px 30px;
        box-shadow: 0 2px 16px rgba(80,110,50,0.12);
        width: 82%; margin: 0 auto 32px auto;
    }
    .form-title {
        font-size: 1.7rem; font-weight: 600;
        color: #193718; margin-bottom: 18px;
    }
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 18px;
    }
    .form-row input, .form-row select {
        width: 100%;
        padding: 13px 16px;
        font-size: 1.13rem;
        border: 2px solid #bfdabc;
        border-radius: 8px;
        background: #f8fbf8;
        color: #224a20;
        outline: none;
        transition: border 0.17s;
    }
    .form-row input:focus, .form-row select:focus {
        border-color: #4ca548;
    }
    .submit-btn {
        width: 100%;
        padding: 17px 0;
        background: linear-gradient(90deg, #4ca548, #347a2a 70%);
        color: #fff;
        border: none;
        font-size: 1.18rem;
        font-weight: bold;
        border-radius: 9px;
        cursor: pointer;
        margin-top: 9px;
        transition: background 0.19s;
    }
    .submit-btn:hover {
        background: linear-gradient(90deg, #347a2a, #4ca548 70%);
    }
    .loading { text-align: center; color: #5a715a; font-style: italic; }
    .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 8px; margin: 10px 0; }
    .recommendation-result {
        background: #f8fbf8;
        border: 2px solid #4ca548;
        border-radius: 12px;
        padding: 20px;
        margin: 15px 0;
    }
    .crop-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: #193718;
        margin-bottom: 10px;
    }
    .confidence-score {
        background: #4ca548;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 15px;
    }
    </style>
</head>
<body>
    <div class="crop-header">
        <button class="back-btn" onclick="window.location.href='dashboard/'">&#8592;</button>
        <div class="crop-header-title">Dashboard</div>
    </div>
    <div class="crop-section-title">Crop Recommendation</div>
    <div class="crop-section-subtitle">Get smart crop suggestions based on your land</div>
    <div class="form-card">
        <div class="form-title">Farm Details</div>
        <form id="recommendation-form">
            <div class="form-row" style="flex-direction:column;">
                <label for="location" style="font-weight:500;">Location <span style="color:#dc3e3e">*</span></label>
                <input type="text" id="location" placeholder="Enter your location" required>
            </div>
            <div class="form-row">
                <div>
                    <label for="nitrogen" style="font-weight:500;">Nitrogen (ppm) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="nitrogen" placeholder="e.g., 100" required>
                </div>
                <div>
                    <label for="phosphorus" style="font-weight:500;">Phosphorus (ppm) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="phosphorus" placeholder="e.g., 50" required>
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="potassium" style="font-weight:500;">Potassium (ppm) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="potassium" placeholder="e.g., 200" required>
                </div>
                <div>
                    <label for="temperature" style="font-weight:500;">Temperature (Â°C) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="temperature" placeholder="e.g., 25" required>
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="humidity" style="font-weight:500;">Humidity (%) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="humidity" placeholder="e.g., 70" required>
                </div>
                <div>
                    <label for="ph" style="font-weight:500;">pH Level <span style="color:#dc3e3e">*</span></label>
                    <input type="number" step="0.1" id="ph" placeholder="e.g., 6.5" required>
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label for="rainfall" style="font-weight:500;">Rainfall (mm) <span style="color:#dc3e3e">*</span></label>
                    <input type="number" id="rainfall" placeholder="e.g., 1000" required>
                </div>
                <div>
                    <label for="land-size" style="font-weight:500;">Land Size (Acres)</label>
                    <input type="number" id="land-size" placeholder="e.g., 5">
                </div>
            </div>
            <button class="submit-btn" type="submit">Get Recommendation</button>
        </form>
    </div>
    
    <div id="recommendation-results" class="form-card" style="display: none;">
        <div class="form-title">Recommendation Results</div>
        <div id="loading" class="loading" style="display: none;">Getting recommendation...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="recommendation-details"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('recommendation-form');
            form.addEventListener('submit', handleRecommendation);
        });

        async function handleRecommendation(e) {
            e.preventDefault();
            
            const resultsDiv = document.getElementById('recommendation-results');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const details = document.getElementById('recommendation-details');
            
            // Show loading state
            resultsDiv.style.display = 'block';
            loading.style.display = 'block';
            error.style.display = 'none';
            details.innerHTML = '';
            
            // Collect form data
            const formData = {
                nitrogen: parseFloat(document.getElementById('nitrogen').value),
                phosphorus: parseFloat(document.getElementById('phosphorus').value),
                potassium: parseFloat(document.getElementById('potassium').value),
                temperature: parseFloat(document.getElementById('temperature').value),
                humidity: parseFloat(document.getElementById('humidity').value),
                ph: parseFloat(document.getElementById('ph').value),
                rainfall: parseFloat(document.getElementById('rainfall').value)
            };
            
            // Create features array for ML model (order matters!)
            const features = [
                formData.nitrogen,
                formData.phosphorus,
                formData.potassium,
                formData.temperature,
                formData.humidity,
                formData.ph,
                formData.rainfall
            ];
            
            try {
                const response = await fetch(`${API_BASE_URL}/recommend/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ features: features })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to get recommendation');
                }
                
                const result = await response.json();
                
                // Hide loading, show results
                loading.style.display = 'none';
                details.innerHTML = `
                    <div class="recommendation-result">
                        <div class="crop-name">${result.recommended_crop}</div>
                        <div class="confidence-score">Recommended Crop</div>
                        <p style="color: #24411f; margin: 10px 0;">
                            Based on your soil and environmental conditions, 
                            <strong>${result.recommended_crop}</strong> is the most suitable crop for your farm.
                        </p>
                        <div style="margin-top: 15px;">
                            <h4 style="color: #193718; margin-bottom: 10px;">Your Input Parameters:</h4>
                            <ul style="color: #24411f; line-height: 1.6;">
                                <li>Nitrogen: ${formData.nitrogen} ppm</li>
                                <li>Phosphorus: ${formData.phosphorus} ppm</li>
                                <li>Potassium: ${formData.potassium} ppm</li>
                                <li>Temperature: ${formData.temperature}Â°C</li>
                                <li>Humidity: ${formData.humidity}%</li>
                                <li>pH Level: ${formData.ph}</li>
                                <li>Rainfall: ${formData.rainfall} mm</li>
                            </ul>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error getting recommendation:', error);
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = 'Failed to get recommendation. Please check your input and try again.';
            }
        }
    </script>
</body>
</html>
